YUI.add("gallery-treeview",function(A){(function(){var I=A.Port(),F=A.DOM,D=I.util.Event,H=I.lang,C={ALT:18,BACK_SPACE:8,CAPS_LOCK:20,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,META:224,NUM_LOCK:144,PAGE_DOWN:34,PAGE_UP:33,PAUSE:19,PRINTSCREEN:44,RIGHT:39,SCROLL_LOCK:145,SHIFT:16,SPACE:32,TAB:9,UP:38};I.widget=I.widget||{};var G=I.widget;var E=function(K,J){E.superclass.constructor.call(this);if(K){this._treeinit(K);}if(J){this.buildTreeFromObject(J);}else{if(H.trim(this._el.innerHTML)){this.buildTreeFromMarkup(K);}}};G.TreeView=E;A.TreeView=E;A.TreeView.KEY=C;A.extend(E,A.PortBase,{id:null,_el:null,_nodes:null,locked:false,_expandAnim:null,_collapseAnim:null,_animCount:0,maxAnim:2,_hasDblClickSubscriber:false,_dblClickTimer:null,currentFocus:null,singleNodeHighlight:false,_currentlyHighlighted:null,setExpandAnim:function(J){this._expandAnim=(G.TVAnim.isValid(J))?J:null;},setCollapseAnim:function(J){this._collapseAnim=(G.TVAnim.isValid(J))?J:null;},animateExpand:function(L,M){if(this._expandAnim&&this._animCount<this.maxAnim){var J=this;var K=G.TVAnim.getAnim(this._expandAnim,L,function(){J.expandComplete(M);});if(K){++this._animCount;this.fire("animStart",{"node":M,"type":"expand"});K.animate();}return true;}return false;},animateCollapse:function(L,M){if(this._collapseAnim&&this._animCount<this.maxAnim){var J=this;var K=G.TVAnim.getAnim(this._collapseAnim,L,function(){J.collapseComplete(M);});if(K){++this._animCount;this.fire("animStart",{"node":M,"type":"collapse"});K.animate();}return true;}return false;},expandComplete:function(J){--this._animCount;this.fire("animComplete",{"node":J,"type":"expand"});},collapseComplete:function(J){--this._animCount;this.fire("animComplete",{"node":J,"type":"collapse"});},_treeinit:function(K){this._el=A.Selector.query("#"+K,null,true);this.id=A.guid(this._el,"yui-tv-auto-id-");this.publish("animStart",this);this.publish("animComplete",this);this.publish("collapse",this);this.publish("collapseComplete",this);this.publish("expand",this);this.publish("expandComplete",this);this.publish("enterKeyPressed",this);this.publish("clickEvent",this);this.publish("focusChanged",this);var J=this;this.publish("dblClickEvent",{onSubscribeCallback:function(){J._hasDblClickSubscriber=true;}});this.publish("labelClick",this);this.publish("highlightEvent",this);this._nodes=[];E.trees[this.id]=this;this.root=new G.RootNode(this);if(this._initEditor){this._initEditor();}},buildTreeFromObject:function(J){var K=function(S,P){var O,T,N,M,R,L,Q;for(O=0;O<P.length;O++){T=P[O];if(H.isString(T)){N=new G.TextNode(T,S);}else{if(H.isObject(T)){M=T.children;delete T.children;R=T.type||"text";delete T.type;switch(H.isString(R)&&R.toLowerCase()){case"text":N=new G.TextNode(T,S);break;case"menu":N=new G.MenuNode(T,S);break;case"html":N=new G.HTMLNode(T,S);break;default:if(H.isString(R)){L=G[R];}else{L=R;}if(H.isObject(L)){for(Q=L;Q&&Q!==G.Node;Q=Q.superclass.constructor){}if(Q){N=new L(T,S);}else{}}else{}}if(M){K(N,M);}}else{}}}};if(!H.isArray(J)){J=[J];}K(this.root,J);},buildTreeFromMarkup:function(L){var K=function(M){var Q,T,P=[],O={},N,R;for(Q=F.getFirstChild(M);Q;Q=F.getNextSibling(Q)){switch(Q.tagName.toUpperCase()){case"LI":N="";O={expanded:F.hasClass(Q,"expanded"),title:Q.title||Q.alt||null,className:H.trim(Q.className.replace(/\bexpanded\b/,""))||null};T=Q.firstChild;if(T.nodeType==3){N=H.trim(T.nodeValue.replace(/[\n\t\r]*/g,""));if(N){O.type="text";O.label=N;}else{T=F.getNextSibling(T);}}if(!N){if(T.tagName.toUpperCase()=="A"){O.type="text";O.label=T.innerHTML;O.href=T.href;O.target=T.target;O.title=T.title||T.alt||O.title;}else{O.type="html";var S=document.createElement("div");S.appendChild(T.cloneNode(true));O.html=S.innerHTML;O.hasIcon=true;}}T=F.getNextSibling(T);switch(T&&T.tagName.toUpperCase()){case"UL":case"OL":O.children=K(T);break;}if(I.lang.JSON){R=Q.getAttribute("yuiConfig");if(R){R=I.lang.JSON.parse(R);O=I.lang.merge(O,R);}}P.push(O);break;case"UL":case"OL":O={type:"text",label:"",children:K(T)};P.push(O);break;}}return P;};var J=A.Selector.query("#"+this.id+"> ul,ol");if(J.length){this.buildTreeFromObject(K(J[0]));}else{}},_getEventTargetTdEl:function(L){var N=L.target,K="td .ygtvrow",O,M=N.get("parentNode");if(N&&M&&!M.hasClass("ygtvrow")){N=N.ancestor("td");M=N&&N.get("parentNode");}if(!N){return null;}O=N._node||N;if(/\bygtv(blank)?depthcell/.test(O.className)){return null;}if(O.id){var J=O.id.match(/\bygtv([^\d]*)(.*)/);if(J&&J[2]&&this._nodes[J[2]]){return O;}}return null;},_onClickEvent:function(M){var K=this,O=this._getEventTargetTdEl(M),L,N,J=function(P){L.focus();if(P||!L.href){L.toggle();try{M.preventDefault();}catch(Q){}}};if(!O){return;}L=this.getNodeByElement(O);if(!L){return;}N=M.target;if(N.hasClass(L.labelStyle)||N.ancestor(L.labelStyle)){this.fire("labelClick",L);}if(/\bygtv[tl][mp]h?h?/.test(O.className)){J(true);}else{if(this._dblClickTimer){window.clearTimeout(this._dblClickTimer);this._dblClickTimer=null;}else{if(this._hasDblClickSubscriber){this._dblClickTimer=window.setTimeout(function(){K._dblClickTimer=null;if(K.fire("clickEvent",{event:M,node:L})!==false){J();}},200);}else{if(K.fire("clickEvent",{event:M,node:L})!==false){J();}}}}},_onDblClickEvent:function(J){if(!this._hasDblClickSubscriber){return;}var K=this._getEventTargetTdEl(J);if(!K){return;}if(!(/\bygtv[tl][mp]h?h?/.test(K.className))){this.fire("dblClickEvent",{event:J,node:this.getNodeByElement(K)});if(this._dblClickTimer){window.clearTimeout(this._dblClickTimer);this._dblClickTimer=null;}}},_onMouseOverEvent:function(J){var K;if((K=this._getEventTargetTdEl(J))&&(K=this.getNodeByElement(K))&&(K=K.getToggleEl())){K.className=K.className.replace(/\bygtv([lt])([mp])\b/gi,"ygtv$1$2h");}},_onMouseOutEvent:function(J){var K;if((K=this._getEventTargetTdEl(J))&&(K=this.getNodeByElement(K))&&(K=K.getToggleEl())){K.className=K.className.replace(/\bygtv([lt])([mp])h\b/gi,"ygtv$1$2");}},_onKeyDownEvent:function(N){var P=N.target,Q=P._node,M=this.getNodeByElement(Q),L=M;
switch(N.keyCode){case C.UP:do{if(L.previousSibling){L=L.previousSibling;}else{L=L.parent;}}while(L&&!L._canHaveFocus());if(L){L.focus();}N.preventDefault();break;case C.DOWN:do{if(L.nextSibling){L=L.nextSibling;}else{L.expand();L=(L.children.length||null)&&L.children[0];}}while(L&&!L._canHaveFocus);if(L){L.focus();}N.preventDefault();break;case C.LEFT:do{if(L.parent){L=L.parent;}else{L=L.previousSibling;}}while(L&&!L._canHaveFocus());if(L){L.focus();}N.preventDefault();break;case C.RIGHT:var K=this,O,J=function(R){K.unsubscribe("expandComplete",J);O(R);};O=function(R){do{if(R.isDynamic()&&!R.childrenRendered){K.subscribe("expandComplete",J);R.expand();R=null;break;}else{R.expand();if(R.children.length){R=R.children[0];}else{R=R.nextSibling;}}}while(R&&!R._canHaveFocus());if(R){R.focus();}};O(L);N.preventDefault();break;case C.ENTER:if(M.href){if(M.target){window.open(M.href,M.target);}else{window.location(M.href);}}else{M.toggle();}this.fire("enterKeyPressed",M);N.preventDefault();break;case C.HOME:L=this.getRoot();if(L.children.length){L=L.children[0];}if(L._canHaveFocus()){L.focus();}N.preventDefault();break;case C.END:L=L.parent.children;L=L[L.length-1];if(L._canHaveFocus()){L.focus();}N.preventDefault();break;case 107:if(N.shiftKey){M.parent.expandAll();}else{M.expand();}break;case 109:if(N.shiftKey){M.parent.collapseAll();}else{M.collapse();}break;default:break;}},render:function(){var J=this.root.getHtml(),K=this.getEl();K.innerHTML=J;if(!this._hasEvents){A.on("click",this._onClickEvent,K,this);A.on("dblclick",this._onDblClickEvent,K,this,true);A.on("mouseover",this._onMouseOverEvent,K,this,true);A.on("mouseout",this._onMouseOutEvent,K,this,true);A.on("keydown",this._onKeyDownEvent,K,this,true);}this._hasEvents=true;},getEl:function(){if(!this._el){var J=A.Selector.query("#"+this.id,null,true);this._el=J;}return this._el;},regNode:function(J){this._nodes[J.index]=J;},getRoot:function(){return this.root;},setDynamicLoad:function(J,K){this.root.setDynamicLoad(J,K);},expandAll:function(){if(!this.locked){this.root.expandAll();}},collapseAll:function(){if(!this.locked){this.root.collapseAll();}},getNodeByIndex:function(K){var J=this._nodes[K];return(J)?J:null;},getNodeByProperty:function(L,K){for(var J in this._nodes){if(this._nodes.hasOwnProperty(J)){var M=this._nodes[J];if((L in M&&M[L]==K)||(M.data&&K==M.data[L])){return M;}}}return null;},getNodesByProperty:function(M,L){var J=[];for(var K in this._nodes){if(this._nodes.hasOwnProperty(K)){var N=this._nodes[K];if((M in N&&N[M]==L)||(N.data&&L==N.data[M])){J.push(N);}}}return(J.length)?J:null;},getNodesBy:function(L){var J=[];for(var K in this._nodes){if(this._nodes.hasOwnProperty(K)){var M=this._nodes[K];if(L(M)){J.push(M);}}}return(J.length)?J:null;},getNodeByElement:function(L){var M=L,J,K=/ygtv([^\d]*)(.*)/;do{if(M&&M.id){J=M.id.match(K);if(J&&J[2]){return this.getNodeByIndex(J[2]);}}M=M.parentNode;if(!M||!M.tagName){break;}}while(M.id!==this.id&&M.tagName.toLowerCase()!=="body");return null;},getHighlightedNode:function(){return this._currentlyHighlighted;},removeNode:function(K,J){if(K.isRoot()){return false;}var L=K.parent;if(L.parent){L=L.parent;}this._deleteNode(K);if(J&&L&&L.childrenRendered){L.refresh();}return true;},_removeChildren_animComplete:function(J){this.unsubscribe(this._removeChildren_animComplete);this.removeChildren(J.node);},removeChildren:function(J){if(J.expanded){if(this._collapseAnim){this.subscribe("animComplete",this._removeChildren_animComplete,this,true);G.Node.prototype.collapse.call(J);return;}J.collapse();}while(J.children.length){this._deleteNode(J.children[0]);}if(J.isRoot()){G.Node.prototype.expand.call(J);}J.childrenRendered=false;J.dynamicLoadComplete=false;J.updateIcon();},_deleteNode:function(J){this.removeChildren(J);this.popNode(J);},popNode:function(M){var N=M.parent;var K=[];for(var L=0,J=N.children.length;L<J;++L){if(N.children[L]!=M){K[K.length]=N.children[L];}}N.children=K;N.childrenRendered=false;if(M.previousSibling){M.previousSibling.nextSibling=M.nextSibling;}if(M.nextSibling){M.nextSibling.previousSibling=M.previousSibling;}if(this.currentFocus==M){this.currentFocus=null;}if(this._currentlyHighlighted==M){this._currentlyHighlighted=null;}M.parent=null;M.previousSibling=null;M.nextSibling=null;M.tree=null;delete this._nodes[M.index];},destroy:function(){if(this._destroyEditor){this._destroyEditor();}var K=this.getEl();D.removeListener(K,"click");D.removeListener(K,"dblclick");D.removeListener(K,"mouseover");D.removeListener(K,"mouseout");D.removeListener(K,"keydown");for(var J=0;J<this._nodes.length;J++){var L=this._nodes[J];if(L&&L.destroy){L.destroy();}}K.innerHTML="";this._hasEvents=false;},toString:function(){return"TreeView "+this.id;},getNodeCount:function(){return this.getRoot().getNodeCount();},getTreeDefinition:function(){return this.getRoot().getNodeDefinition();},onExpand:function(J){},onCollapse:function(J){},setNodesProperty:function(J,L,K){this.root.setNodesProperty(J,L);if(K){this.root.refresh();}},onEventToggleHighlight:function(K){var J;if("node" in K&&K.node instanceof G.Node){J=K.node;}else{if(K instanceof G.Node){J=K;}else{return false;}}J.toggleHighlight();return false;}});var B=E.prototype;B.draw=B.render;E.nodeCount=0;E.trees=[];E.getTree=function(K){var J=E.trees[K];return(J)?J:null;};E.getNode=function(K,L){var J=E.getTree(K);return(J)?J.getNodeByIndex(L):null;};E.FOCUS_CLASS_NAME="ygtvfocus";})();(function(){var D=A.Port(),B=A.DOM,C=D.lang;D.widget.Node=function(G,F,E){if(G){this._nodeinit(G,F,E);}};A.extend(D.widget.Node,A.PortBase,{index:0,children:null,tree:null,data:null,parent:null,depth:-1,expanded:false,multiExpand:true,renderHidden:false,childrenRendered:false,dynamicLoadComplete:false,previousSibling:null,nextSibling:null,_dynLoad:false,dataLoader:null,isLoading:false,hasIcon:true,iconMode:0,nowrap:false,isLeaf:false,contentStyle:"",contentElId:null,enableHighlight:true,highlightState:0,propagateHighlightUp:false,propagateHighlightDown:false,className:null,_type:"Node",_nodeinit:function(H,G,E){D.widget.Node.superclass.constructor.call(this);
this.data={};this.children=[];this.index=D.widget.TreeView.nodeCount;++D.widget.TreeView.nodeCount;this.contentElId="ygtvcontentel"+this.index;if(C.isObject(H)){for(var F in H){if(H.hasOwnProperty(F)){if(F.charAt(0)!="_"&&!C.isUndefined(this[F])&&!C.isFunction(this[F])){this[F]=H[F];}else{this.data[F]=H[F];}}}}if(!C.isUndefined(E)){this.expanded=E;}this.publish("parentChange");if(G){G.appendChild(this);}},applyParent:function(F){if(!F){return false;}this.tree=F.tree;this.parent=F;this.depth=F.depth+1;this.tree.regNode(this);F.childrenRendered=false;for(var G=0,E=this.children.length;G<E;++G){this.children[G].applyParent(this);}this.fire("parentChange",this);return true;},appendChild:function(F){if(this.hasChildren()){var E=this.children[this.children.length-1];E.nextSibling=F;F.previousSibling=E;}this.children[this.children.length]=F;F.applyParent(this);if(this.childrenRendered&&this.expanded){this.getChildrenEl().style.display="";}return F;},appendTo:function(E){return E.appendChild(this);},insertBefore:function(E){var G=E.parent;if(G){if(this.tree){this.tree.popNode(this);}var F=E.isChildOf(G);G.children.splice(F,0,this);if(E.previousSibling){E.previousSibling.nextSibling=this;}this.previousSibling=E.previousSibling;this.nextSibling=E;E.previousSibling=this;this.applyParent(G);}return this;},insertAfter:function(E){var G=E.parent;if(G){if(this.tree){this.tree.popNode(this);}var F=E.isChildOf(G);if(!E.nextSibling){this.nextSibling=null;return this.appendTo(G);}G.children.splice(F+1,0,this);E.nextSibling.previousSibling=this;this.previousSibling=E;this.nextSibling=E.nextSibling;E.nextSibling=this;this.applyParent(G);}return this;},isChildOf:function(F){if(F&&F.children){for(var G=0,E=F.children.length;G<E;++G){if(F.children[G]===this){return G;}}}return -1;},getSiblings:function(){var E=this.parent.children.slice(0);for(var F=0;F<E.length&&E[F]!=this;F++){}E.splice(F,1);if(E.length){return E;}return null;},showChildren:function(){if(!this.tree.animateExpand(this.getChildrenEl(),this)){if(this.hasChildren()){this.getChildrenEl().style.display="";}}},hideChildren:function(){if(!this.tree.animateCollapse(this.getChildrenEl(),this)){this.getChildrenEl().style.display="none";}},getElId:function(){return"ygtv"+this.index;},getChildrenElId:function(){return"ygtvc"+this.index;},getToggleElId:function(){return"ygtvt"+this.index;},getEl:function(){return document.getElementById(this.getElId());},getChildrenEl:function(){return document.getElementById(this.getChildrenElId());},getToggleEl:function(){return document.getElementById(this.getToggleElId());},getContentEl:function(){return document.getElementById(this.contentElId);},collapse:function(){if(!this.expanded){return;}var E=this.tree.onCollapse(this);if(false===E){return;}E=this.tree.fire("collapse",this);if(false===E){return;}if(!this.getEl()){this.expanded=false;}else{this.hideChildren();this.expanded=false;this.updateIcon();}E=this.tree.fire("collapseComplete",this);},expand:function(G){if(this.isLoading||(this.expanded&&!G)){return;}var E=true;if(!G){E=this.tree.onExpand(this);if(false===E){return;}E=this.tree.fire("expand",this);}if(false===E){return;}if(!this.getEl()){this.expanded=true;return;}if(!this.childrenRendered){this.getChildrenEl().innerHTML=this.renderChildren();}else{}this.expanded=true;this.updateIcon();if(this.isLoading){this.expanded=false;return;}if(!this.multiExpand){var H=this.getSiblings();for(var F=0;H&&F<H.length;++F){if(H[F]!=this&&H[F].expanded){H[F].collapse();}}}this.showChildren();E=this.tree.fire("expandComplete",this);},updateIcon:function(){if(this.hasIcon){var E=this.getToggleEl();if(E){E.className=E.className.replace(/\bygtv(([tl][pmn]h?)|(loading))\b/gi,this.getStyle());}}E=document.getElementById("ygtvtableel"+this.index);if(E){if(this.expanded){B.replaceClass(E,"ygtv-collapsed","ygtv-expanded");}else{B.replaceClass(E,"ygtv-expanded","ygtv-collapsed");}}},getStyle:function(){if(this.isLoading){return"ygtvloading";}else{var F=(this.nextSibling)?"t":"l";var E="n";if(this.hasChildren(true)||(this.isDynamic()&&!this.getIconMode())){E=(this.expanded)?"m":"p";}return"ygtv"+F+E;}},getHoverStyle:function(){var E=this.getStyle();if(this.hasChildren(true)&&!this.isLoading){E+="h";}return E;},expandAll:function(){var E=this.children.length;for(var F=0;F<E;++F){var G=this.children[F];if(G.isDynamic()){break;}else{if(!G.multiExpand){break;}else{G.expand();G.expandAll();}}}},collapseAll:function(){for(var E=0;E<this.children.length;++E){this.children[E].collapse();this.children[E].collapseAll();}},setDynamicLoad:function(E,F){if(E){this.dataLoader=E;this._dynLoad=true;}else{this.dataLoader=null;this._dynLoad=false;}if(F){this.iconMode=F;}},isRoot:function(){return(this==this.tree.root);},isDynamic:function(){if(this.isLeaf){return false;}else{return(!this.isRoot()&&(this._dynLoad||this.tree.root._dynLoad));}},getIconMode:function(){return(this.iconMode||this.tree.root.iconMode);},hasChildren:function(E){if(this.isLeaf){return false;}else{return(this.children.length>0||(E&&this.isDynamic()&&!this.dynamicLoadComplete));}},toggle:function(){if(!this.tree.locked&&(this.hasChildren(true)||this.isDynamic())){if(this.expanded){this.collapse();}else{this.expand();}}},getHtml:function(){this.childrenRendered=false;return['<div class="ygtvitem" id="',this.getElId(),'">',this.getNodeHtml(),this.getChildrenHtml(),"</div>"].join("");},getChildrenHtml:function(){var E=[];E[E.length]='<div class="ygtvchildren" id="'+this.getChildrenElId()+'"';if(!this.expanded||!this.hasChildren()){E[E.length]=' style="display:none;"';}E[E.length]=">";if((this.hasChildren(true)&&this.expanded)||(this.renderHidden&&!this.isDynamic())){E[E.length]=this.renderChildren();}E[E.length]="</div>";return E.join("");},renderChildren:function(){var E=this;if(this.isDynamic()&&!this.dynamicLoadComplete){this.isLoading=true;this.tree.locked=true;if(this.dataLoader){setTimeout(function(){E.dataLoader(E,function(){E.loadComplete();});},10);}else{if(this.tree.root.dataLoader){setTimeout(function(){E.tree.root.dataLoader(E,function(){E.loadComplete();
});},10);}else{return"Error: data loader not found or not specified.";}}return"";}else{return this.completeRender();}},completeRender:function(){var F=[];for(var E=0;E<this.children.length;++E){F[F.length]=this.children[E].getHtml();}this.childrenRendered=true;return F.join("");},loadComplete:function(){this.getChildrenEl().innerHTML=this.completeRender();if(this.propagateHighlightDown){if(this.highlightState===1&&!this.tree.singleNodeHighlight){for(var E=0;E<this.children.length;E++){this.children[E].highlight(true);}}else{if(this.highlightState===0||this.tree.singleNodeHighlight){for(E=0;E<this.children.length;E++){this.children[E].unhighlight(true);}}}}this.dynamicLoadComplete=true;this.isLoading=false;this.expand(true);this.tree.locked=false;},getAncestor:function(F){if(F>=this.depth||F<0){return null;}var E=this.parent;while(E.depth>F){E=E.parent;}return E;},getDepthStyle:function(E){return(this.getAncestor(E).nextSibling)?"ygtvdepthcell":"ygtvblankdepthcell";},getNodeHtml:function(){var F=[];F[F.length]='<table id="ygtvtableel'+this.index+'" border="0" cellpadding="0" cellspacing="0" class="ygtvtable ygtvdepth'+this.depth;F[F.length]=" ygtv-"+(this.expanded?"expanded":"collapsed");if(this.enableHighlight){F[F.length]=" ygtv-highlight"+this.highlightState;}if(this.className){F[F.length]=" "+this.className;}F[F.length]='"><tr class="ygtvrow">';for(var E=0;E<this.depth;++E){F[F.length]='<td class="ygtvcell '+this.getDepthStyle(E)+'"><div class="ygtvspacer"></div></td>';}if(this.hasIcon){F[F.length]='<td id="'+this.getToggleElId();F[F.length]='" class="ygtvcell ';F[F.length]=this.getStyle();F[F.length]='"><a href="#" class="ygtvspacer">&#160;</a></td>';}F[F.length]='<td id="'+this.contentElId;F[F.length]='" class="ygtvcell ';F[F.length]=this.contentStyle+' ygtvcontent" ';F[F.length]=(this.nowrap)?' nowrap="nowrap" ':"";F[F.length]=" >";F[F.length]=this.getContentHtml();F[F.length]="</td></tr></table>";return F.join("");},getContentHtml:function(){return"";},refresh:function(){this.getChildrenEl().innerHTML=this.completeRender();if(this.hasIcon){var E=this.getToggleEl();if(E){E.className=E.className.replace(/\bygtv[lt][nmp]h*\b/gi,this.getStyle());}}},toString:function(){return this._type+" ("+this.index+")";},_focusHighlightedItems:[],_focusedItem:null,_canHaveFocus:function(){return this.getEl().getElementsByTagName("a").length>0;},_removeFocus:function(){if(this._focusedItem){A.Event.detach("blur",this._focusedItem);this._focusedItem=null;}var E;while((E=this._focusHighlightedItems.shift())){B.removeClass(E,D.widget.TreeView.FOCUS_CLASS_NAME);}},focus:function(){var I=false,F=this;if(this.tree.currentFocus){this.tree.currentFocus._removeFocus();}var H=function(J){if(J.parent){H(J.parent);J.parent.expand();}};H(this);var E=new A.Node(F.getEl().firstChild);var G=E.queryAll("td");G.each(function(K){if((/ygtv(([tl][pmn]h?)|(content))/).test(K.get("className"))){K.addClass(D.widget.TreeView.FOCUS_CLASS_NAME);if(!I){var J=K.query("a",null,true);if(J){var L=J._node;J.focus();F._focusedItem=L;J.on("blur",function(){F.tree.fire("focusChanged",{oldNode:F.tree.currentFocus,newNode:null});F.tree.currentFocus=null;F._removeFocus();});I=true;}}F._focusHighlightedItems.push(K._node);}});if(I){this.tree.fire("focusChanged",{oldNode:this.tree.currentFocus,newNode:this});this.tree.currentFocus=this;}else{this.tree.fire("focusChanged",{oldNode:F.tree.currentFocus,newNode:null});this.tree.currentFocus=null;this._removeFocus();}return I;},getNodeCount:function(){for(var E=0,F=0;E<this.children.length;E++){F+=this.children[E].getNodeCount();}return F+1;},getNodeDefinition:function(){if(this.isDynamic()){return false;}var H,E=C.merge(this.data),G=[];if(this.expanded){E.expanded=this.expanded;}if(!this.multiExpand){E.multiExpand=this.multiExpand;}if(!this.renderHidden){E.renderHidden=this.renderHidden;}if(!this.hasIcon){E.hasIcon=this.hasIcon;}if(this.nowrap){E.nowrap=this.nowrap;}if(this.className){E.className=this.className;}if(this.editable){E.editable=this.editable;}if(this.enableHighlight){E.enableHighlight=this.enableHighlight;}if(this.highlightState){E.highlightState=this.highlightState;}if(this.propagateHighlightUp){E.propagateHighlightUp=this.propagateHighlightUp;}if(this.propagateHighlightDown){E.propagateHighlightDown=this.propagateHighlightDown;}E.type=this._type;for(var F=0;F<this.children.length;F++){H=this.children[F].getNodeDefinition();if(H===false){return false;}G.push(H);}if(G.length){E.children=G;}return E;},getToggleLink:function(){return"return false;";},setNodesProperty:function(E,H,G){if(E.charAt(0)!="_"&&!C.isUndefined(this[E])&&!C.isFunction(this[E])){this[E]=H;}else{this.data[E]=H;}for(var F=0;F<this.children.length;F++){this.children[F].setNodesProperty(E,H);}if(G){this.refresh();}},toggleHighlight:function(){if(this.enableHighlight){if(this.highlightState==1){this.unhighlight();}else{this.highlight();}}},highlight:function(F){if(this.enableHighlight){if(this.tree.singleNodeHighlight){if(this.tree._currentlyHighlighted){this.tree._currentlyHighlighted.unhighlight(F);}this.tree._currentlyHighlighted=this;}this.highlightState=1;this._setHighlightClassName();if(!this.tree.singleNodeHighlight){if(this.propagateHighlightDown){for(var E=0;E<this.children.length;E++){this.children[E].highlight(true);}}if(this.propagateHighlightUp){if(this.parent){this.parent._childrenHighlighted();}}}if(!F){this.tree.fire("highlightEvent",this);}}},unhighlight:function(F){if(this.enableHighlight){this.tree._currentlyHighlighted=null;this.highlightState=0;this._setHighlightClassName();if(!this.tree.singleNodeHighlight){if(this.propagateHighlightDown){for(var E=0;E<this.children.length;E++){this.children[E].unhighlight(true);}}if(this.propagateHighlightUp){if(this.parent){this.parent._childrenHighlighted();}}}if(!F){this.tree.fire("highlightEvent",this);}}},_childrenHighlighted:function(){var G=false,F=false;if(this.enableHighlight){for(var E=0;E<this.children.length;E++){switch(this.children[E].highlightState){case 0:F=true;
break;case 1:G=true;break;case 2:G=F=true;break;}}if(G&&F){this.highlightState=2;}else{if(G){this.highlightState=1;}else{this.highlightState=0;}}this._setHighlightClassName();if(this.propagateHighlightUp){if(this.parent){this.parent._childrenHighlighted();}}}},_setHighlightClassName:function(){var E=document.getElementById("ygtvtableel"+this.index);if(E){E.className=E.className.replace(/\bygtv-highlight\d\b/gi,"ygtv-highlight"+this.highlightState);}}});})();(function(){var C=A.Port();var B=function(D){this._nodeinit(null,null,true);this.tree=D;};C.widget.RootNode=B;A.extend(B,C.widget.Node,{_type:"RootNode",getNodeHtml:function(){return"";},toString:function(){return this._type;},loadComplete:function(){this.tree.draw();},getNodeCount:function(){for(var D=0,E=0;D<this.children.length;D++){E+=this.children[D].getNodeCount();}return E;},getNodeDefinition:function(){for(var F,D=[],E=0;E<this.children.length;E++){F=this.children[E].getNodeDefinition();if(F===false){return false;}D.push(F);}return D;},collapse:function(){},expand:function(){},getSiblings:function(){return null;},focus:function(){}});})();(function(){var C=A.Port(),B=C.lang;C.widget.TextNode=function(F,E,D){if(F){if(B.isString(F)){F={label:F};}this._nodeinit(F,E,D);this.setUpLabel(F);}};A.extend(C.widget.TextNode,C.widget.Node,{labelStyle:"ygtvlabel",labelElId:null,label:null,title:null,href:null,target:"_self",_type:"TextNode",setUpLabel:function(D){if(B.isString(D)){D={label:D};}else{if(D.style){this.labelStyle=D.style;}}this.label=D.label;this.labelElId="ygtvlabelel"+this.index;},getLabelEl:function(){return document.getElementById(this.labelElId);},getContentHtml:function(){var D=[];D[D.length]=this.href?"<a":"<span";D[D.length]=' id="'+this.labelElId+'"';D[D.length]=' class="'+this.labelStyle+'"';if(this.href){D[D.length]=' href="'+this.href+'"';D[D.length]=' target="'+this.target+'"';}if(this.title){D[D.length]=' title="'+this.title+'"';}D[D.length]=" >";D[D.length]=this.label;D[D.length]=this.href?"</a>":"</span>";return D.join("");},getNodeDefinition:function(){var D=C.widget.TextNode.superclass.getNodeDefinition.call(this);if(D===false){return false;}D.label=this.label;if(this.labelStyle!="ygtvlabel"){D.style=this.labelStyle;}if(this.title){D.title=this.title;}if(this.href){D.href=this.href;}if(this.target!="_self"){D.target=this.target;}return D;},toString:function(){return C.widget.TextNode.superclass.toString.call(this)+": "+this.label;},onLabelClick:function(){return false;},refresh:function(){C.widget.TextNode.superclass.refresh.call(this);var D=this.getLabelEl();D.innerHTML=this.label;if(D.tagName.toUpperCase()=="A"){D.href=this.href;D.target=this.target;}}});})();(function(){var B=A.Port();B.widget.MenuNode=function(E,D,C){B.widget.MenuNode.superclass.constructor.call(this,E,D,C);this.multiExpand=false;};A.extend(B.widget.MenuNode,B.widget.TextNode,{_type:"MenuNode"});})();(function(){var C=A.Port(),B=C.lang;C.widget.HTMLNode=function(G,F,E,D){if(G){this.init(G,F,E);this.initContent(G,D);}};A.extend(C.widget.HTMLNode,C.widget.Node,{contentStyle:"ygtvhtml",html:null,_type:"HTMLNode",initContent:function(E,D){this.setHtml(E);this.contentElId="ygtvcontentel"+this.index;if(!B.isUndefined(D)){this.hasIcon=D;}},setHtml:function(E){this.html=(typeof E==="string")?E:E.html;var D=this.getContentEl();if(D){D.innerHTML=this.html;}},getContentHtml:function(){return this.html;},getNodeDefinition:function(){var D=C.widget.HTMLNode.superclass.getNodeDefinition.call(this);if(D===false){return false;}D.html=this.html;return D;}});})();(function(){var I=A.Port(),F=I.util.Dom,G=I.lang,C=I.util.Event,E=I.widget.TreeView,D=E.prototype;E.editorData={active:false,whoHasIt:null,nodeType:null,editorPanel:null,inputContainer:null,buttonsContainer:null,node:null,saveOnEnter:true,oldValue:undefined};D.validator=null;D._initEditor=function(){};D._nodeEditing=function(O){if(O.fillEditorContainer&&O.editable){var K,M,N,L,J=E.editorData;J.active=true;J.whoHasIt=this;if(!J.nodeType){J.editorPanel=K=document.body.appendChild(document.createElement("div"));F.addClass(K,"ygtv-label-editor");N=J.buttonsContainer=K.appendChild(document.createElement("div"));F.addClass(N,"ygtv-button-container");L=N.appendChild(document.createElement("button"));F.addClass(L,"ygtvok");L.innerHTML=" ";L=N.appendChild(document.createElement("button"));F.addClass(L,"ygtvcancel");L.innerHTML=" ";A.on("click",function(Q){var R=Q.target,S=R._node,P=E.editorData.node;if(R.hasClass("ygtvok")){Q.halt();this._closeEditor(true);}if(R.hasClass("ygtvcancel")){Q.halt();this._closeEditor(false);}},N,this);J.inputContainer=K.appendChild(document.createElement("div"));F.addClass(J.inputContainer,"ygtv-input");A.on("keydown",function(R){var Q=E.editorData,P=A.TreeView.KEY;switch(R.keyCode){case P.ENTER:R.halt();if(Q.saveOnEnter){this._closeEditor(true);}break;case P.ESCAPE:R.halt();this._closeEditor(false);break;}},K,this);}else{K=J.editorPanel;}J.node=O;if(J.nodeType){F.removeClass(K,"ygtv-edit-"+J.nodeType);}F.addClass(K," ygtv-edit-"+O._type);M=F.getXY(O.getContentEl());F.setStyle(K,"left",M[0]+"px");F.setStyle(K,"top",M[1]+"px");F.setStyle(K,"display","block");K.focus();O.fillEditorContainer(J);return true;}};D.onEventEditNode=function(J){if(J instanceof I.widget.Node){J.editNode();}else{if(J.node instanceof I.widget.Node){J.node.editNode();}}};D._closeEditor=function(L){var J=E.editorData,K=J.node,M=true;if(L){M=(J.node.saveEditorValue(J)!==false);}else{this.fire("editorCancelEvent",K);}if(M){F.setStyle(J.editorPanel,"display","none");J.active=false;K.focus();}};D._destroyEditor=function(){var J=E.editorData;if(J&&J.nodeType&&(!J.active||J.whoHasIt===this)){A.Event.detach("keydown",J.editorPanel);A.Event.detach("click",J.buttonContainer);J.node.destroyEditorContents(J);document.body.removeChild(J.editorPanel);J.nodeType=J.editorPanel=J.inputContainer=J.buttonsContainer=J.whoHasIt=J.node=null;J.active=false;}};var H=I.widget.Node.prototype;H.editable=false;H.editNode=function(){this.tree._nodeEditing(this);
};H.fillEditorContainer=null;H.destroyEditorContents=function(J){C.purgeElement(J.inputContainer,true);J.inputContainer.innerHTML="";};H.saveEditorValue=function(J){var M=J.node,N,L=M.tree.validator;N=this.getEditorValue(J);if(G.isFunction(L)){N=L(N,J.oldValue,M);if(G.isUndefined(N)){return false;}}var K=this.tree.fire("editorSaveEvent",{newValue:N,oldValue:J.oldValue,node:M});if(K!==false){this.displayEditedValue(N,J);}};H.getEditorValue=function(J){};H.displayEditedValue=function(K,J){};var B=I.widget.TextNode.prototype;B.fillEditorContainer=function(K){var J;if(K.nodeType!=this._type){K.nodeType=this._type;K.saveOnEnter=true;K.node.destroyEditorContents(K);K.inputElement=J=K.inputContainer.appendChild(document.createElement("input"));}else{J=K.inputElement;}K.oldValue=this.label;J.value=this.label;J.focus();J.select();};B.getEditorValue=function(J){return J.inputElement.value;};B.displayEditedValue=function(L,J){var K=J.node;K.label=L;K.getLabelEl().innerHTML=L;};B.destroyEditorContents=function(J){J.inputContainer.innerHTML="";};})();},"gallery-2009.11.09-19",{requires:["node","gallery-port"]});