YUI.add("gallery-itsadtcolumnresize",function(e,t){"use strict";var n=e.Lang,r=e.Array,i="itsa-resizable-col",s="yui3-datatable-itsacolresizing",o="itsa_width_percented",u="itsa_expansion",a="itsa_defined_col_width_data",f="yes",l="no",c=2;e.namespace("Plugin").ITSADTColumnResize=e.Base.create("itsadtcolumnresize",e.Plugin.Base,[],{_eventhandlers:[],_resizeEventhandlers:[],_allColsResizable:null,datatable:null,_badColWidth:null,_dtWidthDefined:null,_dtWidthIsPercented:null,_dtColNodes:null,_datatableParentNode:null,_dtBoundingBox:null,_dtContentBox:null,_dtXScroller:null,_dtYScroller:null,_dtYScrollBar:null,_dtYScrollerContainer:null,_dtRealDataTableHeader:null,_dtScrollHeader:null,_dtScrollLiners:null,_dtScrollY:null,_resizeApproved:!1,_busyResize:!1,_leftThNode:null,_leftThX:null,_mouseOffset:null,_leftColIndex:null,_lastColIndex:null,_initialColWidth:null,_busyDistributeRemainingSpace:null,_busyTransformAllColumnWidthToPixels:null,_scrollbarOffset:0,_bodyNode:null,_comingFromResize:null,_widthChangeInternally:null,_unselectableBkpList:[],_distributedSpace:0,_notSpecCols:[],initializer:function(){var t=this;t.datatable=t.get("host"),t._badColWidth=e.Features.test("table","badColWidth"),t.datatable.get("rendered")?t._render():t.afterHostEvent("render",t._render,t)},transformToPercent:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsPercent(e)&&(n=t.getColumnWidthPercent(e,!0),r=t.getColumnExpansion(e),t.setColumnWidth(e,n,r))},transformToPixels:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsPixels(e)&&(n=t.getColumnWidthPx(e,!0),r=t.getColumnExpansion(e),t.setColumnWidth(e,n,r))},transformToUndefinedWidth:function(e){var t=this,n,r;t._dtWidthDefined&&!t.columnWidthIsUndefined(e)&&(r=t.getColumnWidthPx(e),t.setColumnWidth(e,r),n=this._getThCel(e),n&&n.setData(a,l))},columnWidthIsPercent:function(e){var t=this._getThCel(e),n=t&&t.getData(o)||"";return n.length>0},columnWidthIsPixels:function(e){var t=this._getThCel(e),n=t&&t.getData(o)||"",r=t&&t.getData(a)||f;return r&&n.length===0},columnWidthIsUndefined:function(e){var t=this._getThCel(e),n=t&&t.getData(a)||f;return!n},getColumnConfigWidth:function(e){var t=this,n=t.datatable,i=n.getColumn(e),s=n.get("columns"),u=r.indexOf(s,i),a=t._dtRealDataTableTHNodes,f=a&&a.item(u),l=f&&f.getData(o)||"";return i&&(l.length>0?l:i.width)||null},getColumnWidthPx:function(e,t){var r=this,i=r.datatable,s=i.getColumn(e),o=r._dtRealDataTableTHNodes,a=0,f=0,l;return s&&s.width&&(f=parseInt(s.width,10)||0),typeof e=="string"?l=r._dtContentBox.one("#"+i.getClassName("col")+"-"+e):n.isNumber(e)&&(l=o&&o.item(e)),a=t?l&&l.getData(u)||0:0,r._busyDistributeRemainingSpace||(f=Math.max(f,l&&l.get("offsetWidth")||0)),f-a},getColumnWidthPercent:function(e,t){var n=this,r=n._dtWidthDefined?parseInt(n._dtXScroller.getStyle("width"),10)+c:n._datatableParentNode.get("offsetWidth"),i=n.getColumnWidthPx(e,t);return(100*i/r).toFixed(2)+"%"},getColumnExpansion:function(e){var t=this,r=t._dtRealDataTableTHNodes,i;return typeof e=="string"?i=t._dtContentBox.one("#"+t.datatable.getClassName("col")+"-"+e):n.isNumber(e)&&(i=r&&r.item(e)),i&&i.getData(u)||0},setColumnWidth:function(t,r,i,s){var l=this,h=n.isNumber(t)?t:l._getColIndexFromName(t),p=l.getColumnWidthPx(h),d=l.datatable,v=l._dtContentBox,m=l._dtColNodes,g=m&&m.item(h),y=l._dtRealDataTable,b=l._dtYScrollerContainer,w=l._dtScrollY,E=l._dtRealDataTableTHNodes,S=E&&E.item(h),x=S&&S.getData(u)||0,T=l._busyResize,N=parseInt(l._dtXScroller.getStyle("width"),10),C=l._dtWidthDefined?N+c:l._datatableParentNode.get("offsetWidth"),k=l._busyTransformAllColumnWidthToPixels,L=d.getColumn(h),A=S&&S.getData(o)||"",O=A.length>0,M=r&&r.substr&&r.substr(r.length-1)==="%",_=l._busyDistributeRemainingSpace,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G;return i=i||0,r=M?parseFloat(r):parseInt(r,10),J=M?A!==r+"%":r!==p,K=M!==O,Q=i!==x,I=l._badColWidth,g&&S&&e.Lang.isNumber(r)&&(J||K||Q||k)&&r>=l.get("minColWidth")?(R=function(e,t,n){return parseInt(n?e.getStyle(t):e.getComputedStyle(t),10)||0},U=function(e,t){var n=0,r;I&&(r=d.getCell([0,h]),r&&(n=R(r,"paddingLeft")+R(r,"paddingRight")+R(r,"borderLeftWidth")+R(r,"borderRightWidth"))),t-=n,e.setStyle("width",t+"px")},z=function(e,t){var n;!k&&i===0&&(M?(S.setData(o,e+"%"),e=Math.round(C*e/100)):S.setData(o,null)),t&&(e+=i,n=S.getData(u)||0,S.setData(u,i),l._distributedSpace+=i-n,!k&&i===0&&S.setData(a,f)),L&&(L.width=e+"px"),U(g,e)},T||(G=O?l.getColumnWidthPercent(h):p),w?P=b:P=y.getStyle("width")==="100%"?v:y,F=R(P,"width",!0),j=m?m.size()-1:0,j>0?(H=m.item(h===j?0:j),B=R(H,"width",!0),H.setStyle("width","")):(D=b||y,D.setStyle("width","1px"),w&&y.setStyle("width","1px")),z(r,!0),$=(M?Math.round(C*r/100):r)+i,r=l.getColumnWidthPx(h),$!==r&&z(M?Math.round(100*r/C):r,!1),j>0?B>0&&H.setStyle("width",B+"px"):(D.setStyle("width",N+"px"),w&&y.setStyle("width",parseInt(b.getStyle("width"),10)+"px")),q=F+r-p,r!==p||k?w?(X=l._dtScrollLiners.item(h),V=X.get("parentNode"),W=I?r:r-R(X,"paddingLeft")-R(X,"paddingRight")-R(V,"borderLeftWidth")-R(V,"borderRightWidth"),U(X,W),!_&&!k&&(l._dtWidthDefined?(b.setStyle("width",q+"px"),l._checkRemainingColSpace()):l._syncYScrollerUI(q))):!_&&!k&&(y.setStyle("width",q+"px"),l._dtWidthDefined?(y.setStyle("width",q+"px"),l._checkRemainingColSpace()):(l._setDTWidthFromInternal(q+c),l._dtXScroller.setStyle("width",q+"px"),l._dtBoundingBox.setStyle("width",q+c+"px"))):j===0&&D.setStyle("width",p+"px"),M&&(r=(100*r/C).toFixed(2)+"%"),(!T||_)&&d.fire("colWidthChange",{colIndex:h,prevVal:G,newVal:s&&!M?(100*r/C).toFixed(2)+"%":r})):r=A||p,r},syncTableUI:function(){var e=this;e._widthChangeInternally||(e._widthChangeInternally=!0,e._justifyTableWidth()),e._widthChangeInternally=!1},destructor:function(){var t=this,r=t.datatable,i=r._eventHandles,o=r.get("sortable");t._resizeEvent&&t._resizeEvent.detach(),t._clearEventhandlers(),t._clearResizeEventhandlers(),t._dtBoundingBox.removeClass(s),n.isBoolean(o)&&o&&(i.sortUITrigger=r.delegate(["click","keydown"
],e.rbind("_onUITriggerSort",r),"."+r.getClassName("sortable","column")))},_render:function(){var t=this,n=t.datatable,r=n.get("scrollable"),i=r&&r.indexOf("x")>-1;i?t._initUI():e.use("datatable-scroll",e.bind(function(e){n.set("scrollable",r&&r.indexOf("y")>-1?"xy":"x"),this._initUI()},t))},_initUI:function(){var e=this,t=e.datatable,n=t.get("width");n===""?(e._dtWidthDefined=!1,e._setDTWidthFromInternal(1)):(e._dtWidthDefined=!0,e._dtWidthIsPercented=n.substr(n.length-1)==="%"),e._initPrivateVars(),e._justifyTableWidth(),e._bindUI()},_bindUI:function(){var t=this,r=t.datatable,i=t._eventhandlers,s=r.get("sortable"),o;t._activateColResizer({newVal:r.get("colsresizable")}),i.push(r.after(["colsresizableChange"],t._activateColResizer,t)),i.push(r.after(["renderView","columnsChange","dataChange","scrollableChange"],t.syncTableUI,t)),i.push(r.after(["widthChange"],t._justifyTableAfterTableWidthChange,t)),r._scrollResizeHandle&&r._scrollResizeHandle.detach(),r._scrollResizeHandle=e.on("resize",e.rbind(t._syncScrollUIPercentedDT,t)),n.isBoolean(s)&&s&&(o=r._eventHandles.sortUITrigger,o&&(o.detach(),o=null),r._theadNode&&(i.push(r.delegate("keydown",e.rbind(t._triggerSort,t),"."+r.getClassName("sortable","column"))),i.push(r.delegate("click",e.rbind(t._triggerSort,t),function(){return!t._comingFromResize&&this.hasClass(r.getClassName("sortable","column"))}))))},_activateColResizer:function(e){var t=this,r=e.newVal,i=t._resizeEventhandlers,s=n.isBoolean(r),o=t._dtScrollHeader||t._dtRealDataTableHeader;s&&!r?t._clearResizeEventhandlers():(t._allColsResizable=s&&r,i.push(o.delegate(["mousemove","touchstart"],t._checkResizeAprovement,"th",t)),i.push(o.on("mouseleave",t._checkEndResizeApprovement,t)),i.push(o.delegate(["mousedown","touchstart"],t._startResize,"th",t)),i.push(t._bodyNode.on(["mouseup","mouseleave","touchend"],t._stopResize,t)))},_syncScrollUIPercentedDT:function(){var t=this,n=t.datatable;t._resizeEventMayOccur&&t._dtWidthIsPercented?(e.rbind(n._syncScrollUI,n)(),t.syncTableUI()):t._resizeEventMayOccur=!0},_triggerSort:function(t){var n=this,s=n.datatable,o=n._dtContentBox,u=n._dtYScrollerContainer,a=n._dtRealDataTable,f,l,h,p;n._dtScrollY?(h=parseInt(u.getStyle("width"),10),p=parseInt(a.getStyle("width"),10),l=[],f=n._dtScrollHeader.all("th"),f.each(function(e,t){e.hasClass(i)&&l.push(t)}),e.bind("_onUITriggerSort",s,t)(),r.each(l,function(e){f.item(e).addClass(i)}),u.setStyle("width",h+"px"),a.setStyle("width",p+"px"),n._dtYScrollBar.setStyle("left",parseInt(n._dtXScroller.getStyle("width"),10)-15+"px")):(o.setStyle("width",parseInt(n._dtRealDataTable.getStyle("width"),10)+c+"px"),e.bind("_onUITriggerSort",s,t)(),o.setStyle("width",""))},_startResize:function(t){var n=this,r,i=n._dtYScrollerContainer,s,o,u,a,f,l,c,h,p,d;n._resizeApproved&&(n._busyResize=!0,n._comingFromResize=!0,n._resizeEvent=n._bodyNode.on(["mousemove","touchmove"],n._resizeColumn,n),r=n.datatable,s=e.UA.mobile?n.get("resizeMarginTouchDevice"):n.get("resizeMargin"),o=Math.round(s/2),u=t.currentTarget,a=u.next("th")===null,l=t.pageX,c=u.get("offsetWidth")-(i?parseInt(u.getStyle("paddingRight"),10):0),h=u.getX(),p=l>h+c-(a?s:o),p?(n._leftThNode=u,n._leftThX=h,n._mouseOffset=h+c-l):(n._leftThNode=u.previous("th"),n._leftThX=n._leftThNode.getX(),n._mouseOffset=h-l),f=u.get("parentNode").all("th"),n._leftColIndex=d=f.indexOf(n._leftThNode),n._initialColWidth=n.columnWidthIsPercent(d)?n.getColumnWidthPercent(d):n.getColumnWidthPx(d),n._changeUnselectableIE(!0))},_stopResize:function(t){var n=this,r=n.datatable,i=n._leftColIndex,s,o;n._busyResize&&(n._resizeEvent&&n._resizeEvent.detach(),o=n.getColumnWidthPx(n._leftColIndex),n._busyResize=!1,n._changeUnselectableIE(!1),n._checkResizeAprovement(t),t.halt(),n._initialColWidth!==o&&(n.columnWidthIsPercent(i)&&(s=n._dtWidthDefined?parseInt(n._dtXScroller.getStyle("width"),10)+c:n._datatableParentNode.get("offsetWidth"),o=(100*o/s).toFixed(2)+"%"),r.fire("colWidthChange",{colIndex:i,prevVal:n._initialColWidth,newVal:o})),e.later(200,n,function(){n._comingFromResize=!1}))},_checkResizeAprovement:function(t){if(!this._busyResize){var n=this,r=n.datatable,o=r.get("boundingBox"),u=t.currentTarget,a=u.next("th")===null,f=u.getX(),l=t.pageX,c=u.get("offsetWidth")-(n._dtYScrollerContainer?parseInt(u.getStyle("paddingRight"),10):0),h=e.UA.mobile?n.get("resizeMarginTouchDevice"):n.get("resizeMargin"),p=Math.round(h/2),d,v,m,g,y;d=l-f,v=f+c-l,m=d<p,g=v<(a?h:p),y=m&&u.previous("th")===null,n._resizeApproved=(m||g)&&!y&&(n._allColsResizable||(m?u.previous("th"):u).hasClass(i)),o.toggleClass(s,n._resizeApproved)}},_resizeColumn:function(e){if(this._busyResize){e.preventDefault();var t=this,n=t._leftColIndex,r=t._lastColIndex,i=t.getColumnWidthPx(n),s=Math.round(e.pageX-t._leftThX+t._mouseOffset),o=t._distributedSpace,u,a,f,l,h,p;n===r&&(f=t._dtYScrollerContainer||t._dtRealDataTable,l=parseInt(t._dtXScroller.getStyle("width"),10),p=parseInt(f.getStyle("width"),10),u=t._dtWidthDefined&&l>=p&&s<i&&o===0),u||(t._dtWidthDefined&&n===r&&s<i&&(s=i-Math.min(i-s,p-l+o)),t.columnWidthIsPercent(n)&&(h=t._dtWidthDefined?parseInt(t._dtXScroller.getStyle("width"),10)+c:t._datatableParentNode.get("offsetWidth"),s=(100*s/h).toFixed(2)+"%",i=(100*i/h).toFixed(2)+"%"),a=t.setColumnWidth(n,s),i!==a&&t.datatable.fire("resize:colWidthChange",{colIndex:n,prevVal:i,newVal:a}))}},_checkEndResizeApprovement:function(){var e=this;e._resizeApproved&&!e._busyResize&&e._endResizeApprovement()},_endResizeApprovement:function(){var e=this;e._resizeApproved=!1,e.datatable.get("boundingBox").toggleClass(s,!1)},_initPrivateVars:function(){var t=this,n=t.datatable,r=n.get("scrollable"),i,s,o,u,a,f;t._bodyNode=e.one("body"),t._dtBoundingBox=n.get("boundingBox"),t._datatableParentNode=t._dtBoundingBox.get("parentNode"),t._dtContentBox=i=n.get("contentBox"),t._dtRealDataTable=s=i.one("."+n.getClassName("table")),t._dtXScroller=i.one("."+n.getClassName("x","scroller")),t._dtYScroller=i.one("."+n.getClassName("y","scroller")),
t._dtYScrollerContainer=u=i.one("."+n.getClassName("y","scroller","container")),t._dtYScrollBar=i.one("."+n.getClassName("scrollbar")),t._dtRealDataTableHeader=a=s.one("."+n.getClassName("columns")),t._dtRealDataTableTHNodes=a.all("th"),f=i.one("colgroup"),t._dtColNodes=f&&f.all("col"),t._dtScrollHeader=o=u&&u.one("."+n.getClassName("scroll","columns")),t._dtScrollLiners=o&&o.all("."+n.getClassName("scroll","liner")),t._dtScrollY=r==="y"||r==="xy"||r===!0},_justifyTableAfterTableWidthChange:function(){var e=this,t=e.datatable,n;e._busyResize||(n=t.get("width"),n===""?(e._dtWidthDefined=!1,e._setDTWidthFromInternal(1)):(e._dtWidthDefined=!0,e._dtWidthIsPercented=n.substr(n.length-1)==="%"),e.syncTableUI())},_justifyTableWidth:function(){var e=this,t=e.datatable,r=e._dtRealDataTable,s=e._dtYScrollerContainer,o=e._dtYScrollBar,u=e._dtXScroller,a=e._dtScrollY,f=e._dtScrollHeader,l=e._dtRealDataTableTHNodes,h=e._dtWidthDefined,p=0,d,v,m,g;h||u.setStyle("overflowX","hidden"),e._lastColIndex=m=l.size()-1,r.setStyle("width","1px"),a&&s.setStyle("width","1px"),g=e._transformAllColumnWidthToPixels(),e._distributedSpace>0&&(e._distributedSpace=0),a&&(d=s&&f.all("th"),e._scrollbarOffset=p=d&&parseInt(d.item(d.size()-1).getStyle("paddingRight"),10)||0,g+=p,s.setStyle("width",g+"px")),r.setStyle("width",g+"px"),g=Math.max(g,parseInt(u.getStyle("width"),10)),a?(f.all("th").each(function(e,r){v=t.getColumn(r),e.toggleClass(i,n.isBoolean(v.resizable)&&v.resizable)}),o.setStyle("width","16px"),e._syncYScrollerUI(g)):(l.each(function(e,r){v=t.getColumn(r),e.toggleClass(i,n.isBoolean(v.resizable)&&v.resizable)}),h?e._checkRemainingColSpace():e._setDTWidthFromInternal(g+c))},_transformAllColumnWidthToPixels:function(){var e=this,t=e.datatable,n=e._dtWidthDefined?parseInt(e._dtXScroller.getStyle("width"),10)+c:e._datatableParentNode.get("offsetWidth"),i=e._notSpecCols,s=0,h=0,p=e._dtRealDataTableTHNodes,d,v,m,g,y,b,w,E,S,x,T;return e._busyTransformAllColumnWidthToPixels=!0,i.length=0,p.each(function(r,c){g=t.getColumn(c),m=g&&g.width,y=m&&m.substr(m.length-1)==="%",w=p&&p.item(c),S=w&&w.getData(u)||0,E=w&&w.getData(o)||"",T=E.length>0,x=w&&w.getData(a)||f,x===f&&(y||T?(T&&(m=E),w&&w.setData(o,m),m=g.width=Math.round(n*parseFloat(m)/100)+"px",d=!0):(d=!1,w&&w.setData(o,null))),m&&x===f?(v=parseInt(m,10)-S,s+=e.setColumnWidth(c,v,0,d)):(i.push(c),w&&w.setData(a,l))}),i.length>0&&(h=0,r.each(i,function(t){h+=e.setColumnWidth(t,e.getColumnWidthPx(t,!0))})),b=s+h,e._busyTransformAllColumnWidthToPixels=!1,b},_changeUnselectableIE:function(t){var n=this,r=n._dtScrollHeader||n._dtRealDataTableHeader,i=r&&r.all("th"),s=n._unselectableBkpList,o;e.UA.ie>0&&(o=s.length>0,i.each(function(e,r){t&&!o&&n._unselectableBkpList.push(e.get("unselectable")||""),e.setAttribute("unselectable",t?"on":s.length>r?s[r]:"")},n))},_checkRemainingColSpace:function(e){var t=this,n=t._dtXScroller,r=t._distributedSpace,i=parseInt(n.getStyle("width"),10),s,o,u;t._dtWidthDefined&&(t._busyDistributeRemainingSpace=!0,o=t._dtYScrollerContainer||t._dtRealDataTable,u=e||parseInt(o.getStyle("width"),10),s=r+i-u,n.setStyle("overflowX",s<0?"scroll":"hidden"),s=Math.max(0,s),o.setStyle("width",i+"px"),t._distributeRemainingSpace(s),t._busyDistributeRemainingSpace=!1,u=u+s-r,t._dtScrollY?t._syncYScrollerUI(u,!0):t._dtRealDataTable.setStyle("width",u+"px"),t._distributedSpace=s)},_distributeRemainingSpace:function(e){var t=this,n=t._notSpecCols,i=n.length,s,o;i>0?(s=Math.round(e/i),o=s+e-s*i,r.each(n,function(e,n){var r=n===i-1?o:s;t.setColumnWidth(e,t.getColumnWidthPx(e,!0),r)})):t._expandLastCell(e)},_expandLastCell:function(e){var t=this,n=t._lastColIndex;t.setColumnWidth(n,t.getColumnWidthPx(n,!0),e)},_syncYScrollerUI:function(t,n){var r=this,i=r.datatable,s=r._dtRealDataTable,o=r._dtYScrollerContainer,u,a;r._busyDistributeRemainingSpace||(r._dtWidthDefined?(a=parseInt(r._dtXScroller.getStyle("width"),10),t=Math.max(t,a),s.setStyle("width",t-r._scrollbarOffset+"px")):(r._setDTWidthFromInternal(t+c),r._dtXScroller.setStyle("width",t+"px"),r._dtBoundingBox.setStyle("width",t+c+"px")),u=parseInt(o.getStyle("width"),10),o.setStyle("width",t+"px"),r._dtYScroller.setStyle("width",t+"px"),n||r._checkRemainingColSpace(u),r._dtWidthDefined||e.rbind(i._syncScrollUI,i)(),r._dtYScrollBar.setStyle("left",parseInt(r._dtXScroller.getStyle("width"),10)-15+"px"))},_getThCel:function(e){var t=this,r=t._dtRealDataTableTHNodes,i;return n.isNumber(e)||(i=t._getColIndexFromName(e)),r&&r.item(i||e)},_getColIndexFromName:function(e){var t=this,n,i,s,o;return typeof e=="string"&&(n=t.datatable,i=n.getColumn(e),s=n.get("columns"),o=r.indexOf(s,i)),o||-1},_setDTWidthFromInternal:function(e){var t=this,n=t.datatable,r=t._dtRealDataTable,i;t._dtWidthDefined||(i=r&&parseInt(r.getStyle("width"),10),t._widthChangeInternally=!0,n.set("width",e+"px"),t._widthChangeInternally=!1,t._dtWidthDefined=!1,r&&r.setStyle("width",Math.max(i,parseInt(t._dtXScroller.getStyle("width"),10))+"px"))},_clearResizeEventhandlers:function(){r.each(this._resizeEventhandlers,function(e){e.detach()})},_clearEventhandlers:function(){r.each(this._eventhandlers,function(e){e.detach()})}},{NS:"itsadtcr",ATTRS:{resizeMargin:{value:10,validator:function(t){return e.Lang.isNumber(t)&&t>=2&&t<=60}},resizeMarginTouchDevice:{value:20,validator:function(t){return e.Lang.isNumber(t)&&t>=2&&t<=60}},minColWidth:{value:0,validator:function(t){return e.Lang.isNumber(t)&&t>=0}}}})},"gallery-2013.01.23-21-59",{requires:["base-build","plugin","node-base","node-screen","node-event-delegate","event-mouseenter","event-custom","event-resize","event-touch","datatable-column-widths"],skinnable:!0});
